"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Slider=function(){function i(e,t,n){_classCallCheck(this,i),this.idSlide=e,this.slides=t,this.arrayText=n,this.currentSlide=0,this.time="",this.prevBtn=document.getElementById("prevBtn"),this.nextBtn=document.getElementById("nextBtn"),this.playBtn=document.getElementById("playBtn"),this.pauseBtn=document.getElementById("pauseBtn"),this.nextBtn.addEventListener("click",this.nextSlide.bind(this)),this.prevBtn.addEventListener("click",this.prevSlide.bind(this)),this.playBtn.addEventListener("click",this.playPause.bind(this)),this.pauseBtn.addEventListener("click",this.playPause.bind(this)),this.playPause(),this.showingSlide(),this.keyboardEvent()}return _createClass(i,[{key:"showingSlide",value:function(){this.currentSlide<0&&(this.currentSlide=this.slides.length-1),this.currentSlide===this.slides.length&&(this.currentSlide=0),this.idSlide.src=this.slides[this.currentSlide],this.displayText()}},{key:"displayText",value:function(){for(var e=0;e<this.arrayText.length;e++)this.currentSlide===e?this.arrayText[this.currentSlide].style.display="inherit":this.arrayText[e].style.display="none"}},{key:"nextSlide",value:function(){clearInterval(this.time),this.currentSlide++,this.showingSlide(),this.time=setInterval(this.nextSlide.bind(this),5e3)}},{key:"prevSlide",value:function(){clearInterval(this.time),this.currentSlide--,this.showingSlide(),this.time=setInterval(this.nextSlide.bind(this),5e3)}},{key:"playPause",value:function(){var e=document.getElementById("pauseBtn"),t=document.getElementById("playBtn");this.time?(clearInterval(this.time),this.time="",e.style.display="none",t.style.display="block"):(this.time=setInterval(this.nextSlide.bind(this),5e3),e.style.display="block",t.style.display="none")}},{key:"keyboardEvent",value:function(){var n=this;document.addEventListener("keydown",function(e){var t=e.key;"ArrowRight"===t&&n.nextSlide(),"ArrowLeft"===t&&n.prevSlide()})}}]),i}();function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a,s=!0,r=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(r)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Map=function(){function n(e,t){_classCallCheck(this,n),this.lat=e,this.lon=t,this.myMap=L.map("map"),this.isStationSelected=!1,this.pinGreen=L.icon({iconUrl:"./images/pin_green.png",iconSize:[40,40],iconAnchor:[20,40],popupAnchor:[-3,-76]}),this.pinRed=L.icon({iconUrl:"./images/pin_red.png",iconSize:[40,40],iconAnchor:[20,40],popupAnchor:[-3,-76]}),this.stationName=document.getElementById("stationName"),this.stationLocation=document.getElementById("stationLocation"),this.stationStatus=document.getElementById("stationStatus"),this.availableBikes=document.getElementById("availableBikes"),this.initMap(),this.getStationData()}return _createClass(n,[{key:"initMap",value:function(){this.myMap.setView([this.lat,this.lon],12),L.tileLayer("https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",{attribution:"données © OpenStreetMap/ODbL - rendu OSM France",minZoom:1,maxZoom:20}).addTo(this.myMap)}},{key:"getStationData",value:function(){var t=this;fetch("https://api.jcdecaux.com/vls/v1/stations?contract=marseille&apiKey=16fb384f5213dfb5f267956480bdba613d304c76",{method:"GET",headers:{id:"16fb384f5213dfb5f267956480bdba613d304c76"},redirect:"follow"}).then(function(e){return e.json()}).then(function(e){return t.addMarker(e)})}},{key:"addMarker",value:function(e){var t,n=this,i=_createForOfIteratorHelper(e);try{var a=function(){var e=t.value;(0<e.available_bikes&&"OPEN"===e.status?L.marker([e.position.lat,e.position.lng],{icon:n.pinGreen}).addTo(n.myMap):L.marker([e.position.lat,e.position.lng],{icon:n.pinRed}).addTo(n.myMap)).on("click",function(){return n.displayDataStation(e)})};for(i.s();!(t=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}},{key:"displayDataStation",value:function(e){var t=document.getElementById("noStationSelected"),n=document.getElementById("dataStationSelected");t.style.display="none",n.style.display="block";var i=function(e){return"OPEN"===e.status},a=e.name.substring(e.name.indexOf("-")+1),s=e.address.substring(e.address.indexOf("-")+1);0<e.available_bikes&&i&&(this.stationStatus.innerHTML="Ouvert",this.stationName.innerHTML=a,this.stationLocation.innerHTML=s,this.availableBikes.innerHTML=e.available_bikes,sessionStorage.setItem("stationName",a),this.isStationSelected=!0),0===e.available_bikes&&i&&(this.stationStatus.innerHTML="Indisponible",this.stationName.innerHTML=a,this.stationLocation.innerHTML=s,this.availableBikes.innerHTML="Aucun vélo n'est disponible",this.isStationSelected=!1)}}]),n}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Reservation=function(){function t(e){_classCallCheck(this,t),this.map=e,this.canvas="",this.reservationBtn=document.getElementById("reservationBtn"),this.checkBtn=document.getElementById("checkBtn"),this.recapBlock=document.getElementById("recapBlock"),this.getUserData(),this.reservationBtn.addEventListener("click",this.onSubmit.bind(this)),this.checkBtn.addEventListener("click",this.onValidate.bind(this))}return _createClass(t,[{key:"isFormValid",value:function(e,t){return""!==e&&""!==t&&!0===this.map.isStationSelected}},{key:"getUserData",value:function(){var e=localStorage.getItem("surname"),t=localStorage.getItem("name");e&&(document.getElementById("surname").value=e),t&&(document.getElementById("name").value=t)}},{key:"storeUserData",value:function(e,t){localStorage.setItem("surname",t),localStorage.setItem("name",e)}},{key:"onSubmit",value:function(){var e=document.getElementById("surname").value,t=document.getElementById("name").value;this.isFormValid(e,t)?(this.storeUserData(t,e),this.canvas=new Canvas,document.getElementById("form").style.display="none",document.getElementById("canvasBlock").style.display="block"):document.getElementById("errorMsg").innerHTML="⛔️ Veuillez sélectionner une station et remplir les champs avant de valider"}},{key:"onValidate",value:function(){document.getElementById("recapBlock").style.display="block",document.getElementById("canvasBlock").style.display="none",document.getElementById("form").style.display="block",document.getElementById("errorMsg").style.display="none",this.reservationRecap(),this.canvas.clearCanvas(),this.recapBlock.scrollIntoView()}},{key:"reservationRecap",value:function(){document.getElementById("reservationRecap").innerHTML="1 vélo est réservé à la station "+sessionStorage.getItem("stationName"),document.getElementById("userRecap").innerHTML="pour "+localStorage.getItem("surname")+" "+localStorage.getItem("name"),(new Timer).launchTimer()}}]),t}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Canvas=function(){function e(){_classCallCheck(this,e),this.canvas=document.getElementById("canvas"),this.context=this.canvas.getContext("2d"),this.x=0,this.y=0,this.isDrawing=!1,this.initCanvas()}return _createClass(e,[{key:"initCanvas",value:function(){var n=this;this.canvas.addEventListener("mousedown",function(e){n.x=e.pageX-n.canvas.offsetLeft,n.y=e.pageY-n.canvas.offsetTop,n.isDrawing=!0}),this.canvas.addEventListener("mousemove",function(e){n.isDrawing&&(n.draw(n.x,n.y,e.pageX-n.canvas.offsetLeft,e.pageY-n.canvas.offsetTop),n.x=e.pageX-n.canvas.offsetLeft,n.y=e.pageY-n.canvas.offsetTop)}),window.addEventListener("mouseup",function(e){n.isDrawing&&(n.draw(n.x,n.y,e.pageX-n.canvas.offsetLeft,e.pageY-n.canvas.offsetTop),n.x=0,n.y=0,n.isDrawing=!1,document.getElementById("checkBtn").disabled=!1)}),this.canvas.addEventListener("touchstart",function(e){var t=e.changedTouches[0];n.x=t.pageX-n.canvas.offsetLeft,n.y=t.pageY-n.canvas.offsetTop,n.isDrawing=!0,e.preventDefault()}),this.canvas.addEventListener("touchmove",function(e){if(n.isDrawing){var t=e.changedTouches[0];n.draw(n.x,n.y,t.pageX-n.canvas.offsetLeft,t.pageY-n.canvas.offsetTop),n.x=t.pageX-n.canvas.offsetLeft,n.y=t.pageY-n.canvas.offsetTop}e.preventDefault()}),window.addEventListener("touchend",function(e){if(n.isDrawing){var t=e.changedTouches[0];n.draw(n.x,n.y,t.pageX-n.canvas.offsetLeft,t.pageY-n.canvas.offsetTop),n.x=0,n.y=0,n.isDrawing=!1,document.getElementById("checkBtn").disabled=!1,e.preventDefault()}})}},{key:"draw",value:function(e,t,n,i){this.context.beginPath(),this.context.strokeStyle="black",this.context.lineWidth=5,this.context.moveTo(e,t),this.context.lineTo(n,i),this.context.stroke()}},{key:"clearCanvas",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Timer=function(){function e(){_classCallCheck(this,e),this.totalTime=12e6,this.endTime=0,this.now=(new Date).getTime()}return _createClass(e,[{key:"countTimer",value:function(){this.endTime=this.now+this.totalTime,this.distance=this.endTime-(new Date).getTime();var e=Math.floor(this.distance%36e5/6e4),t=Math.floor(this.distance%6e4/1e3);0<this.distance&&(document.getElementById("timer").innerHTML=e+"m "+t+"s"),this.distance<=0&&(document.getElementById("timer").innerHTML="La réservation a expiré ",sessionStorage.clear(),clearInterval())}},{key:"launchTimer",value:function(){setInterval(this.countTimer.bind(this),1e3)}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var App=function e(){_classCallCheck(this,e),this.lat=43.3,this.lon=5.4,this.id=document.getElementById("slideImg"),this.slides=["images/img1.jpg","images/img2.jpg","images/img3.jpg"],this.arrayText=document.getElementById("slideText").getElementsByClassName("text"),this.map=new Map(this.lat,this.lon),this.slider=new Slider(this.id,this.slides,this.arrayText),this.reservation=new Reservation(this.map)},app=new App;